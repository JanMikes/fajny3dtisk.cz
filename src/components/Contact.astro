---
import { Mail, MapPin, Building } from 'lucide-astro';
---

<section id="kontakt" class="py-20 px-6 bg-white">
  <div class="max-w-6xl mx-auto">
    <!-- Section Header -->
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-brand-dark-red mb-4">
        Kontakt na 3D tisk Frýdek-Místek
      </h2>
      <p class="text-lg text-gray-700 mb-2">
        Máte nápad? Chcete rychlou cenovku? Vyplňte formulář a já se vám ozvu rychlostí roztaveného filamentu.
      </p>
      <p class="text-gray-600">
        Jsme sice z Frýdku-Místku, zásilku vám ale pošleme kamkoliv, třeba i na severní pól (pokud to tam kurýr zvládne doručit…)!
      </p>
    </div>

    <!-- Contact Grid -->
    <div class="grid lg:grid-cols-2 gap-8 items-start">
      <!-- Contact Form -->
      <div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
        <form id="contact-form" novalidate>
          <div class="space-y-5">
            <!-- Name Field -->
            <div>
              <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                Jméno <span class="text-brand-red">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                placeholder="Jan Novák"
                required
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all duration-200"
              />
            </div>

            <!-- Email Field -->
            <div>
              <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                E-mail <span class="text-brand-red">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="jan.novak@example.com"
                required
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all duration-200"
              />
            </div>

            <!-- Phone Field -->
            <div>
              <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
                Telefon
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                placeholder="+420 777 666 555"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all duration-200"
              />
            </div>

            <!-- Message Field -->
            <div>
              <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">
                Zpráva
              </label>
              <textarea
                id="message"
                name="message"
                rows="5"
                placeholder="Co potřebujete vytisknout?"
                class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-brand-orange focus:ring-2 focus:ring-brand-orange/20 outline-none transition-all duration-200 resize-none"
              ></textarea>
            </div>

            <!-- Submit Button -->
            <button
              type="submit"
              class="w-full bg-brand-red hover:bg-brand-orange text-white font-bold py-4 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 hover:shadow-xl"
            >
              Odeslat poptávku
            </button>
          </div>
        </form>

        <!-- Form Response Message -->
        <div id="form-message" class="hidden mt-4"></div>
      </div>

      <!-- Contact Information -->
      <div class="space-y-6">
        <!-- Contact Card -->
        <div class="bg-gradient-to-br from-brand-orange/10 to-brand-red/10 rounded-2xl p-8 border border-brand-orange/20">
          <h3 class="text-2xl font-bold text-brand-black mb-6">Kontaktní údaje</h3>

          <div class="space-y-4">
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-brand-red flex items-center justify-center">
                <Building class="w-5 h-5 text-white" />
              </div>
              <div>
                <p class="font-bold text-gray-900">Michal Trněný</p>
                <p class="text-gray-600 text-sm">IČ 14406713 – nejsem plátce DPH</p>
              </div>
            </div>

            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-brand-red flex items-center justify-center">
                <MapPin class="w-5 h-5 text-white" />
              </div>
              <div>
                <p class="text-gray-900">Jana Čapka 3081</p>
                <p class="text-gray-900">738 01 Frýdek-Místek</p>
              </div>
            </div>

            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-10 h-10 rounded-lg bg-brand-red flex items-center justify-center">
                <Mail class="w-5 h-5 text-white" />
              </div>
              <div>
                <a
                  href="mailto:michal@fajny3dtisk.cz"
                  class="text-brand-red hover:text-brand-orange font-semibold transition-colors duration-200"
                >
                  michal@fajny3dtisk.cz
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Info Box -->
        <div class="bg-brand-gray rounded-xl p-6">
          <p class="text-gray-700 leading-relaxed">
            <strong>Rychlá odezva:</strong> Na dotazy odpovídám běžně do 24 hodin, často i rychleji. Frank zatím hlídá, aby nic neuniklo!
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const formMessage = document.getElementById("form-message");

    if (!form || !formMessage) return;

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      let isValid = true;
      const name = document.getElementById("name") as HTMLInputElement;
      const email = document.getElementById("email") as HTMLInputElement;
      const phone = document.getElementById("phone") as HTMLInputElement;
      const message = document.getElementById("message") as HTMLTextAreaElement;

      // Remove previous errors
      document.querySelectorAll(".error-message").forEach((el) => el.remove());
      document.querySelectorAll(".border-red-500").forEach((el) => {
        el.classList.remove("border-red-500");
        el.classList.add("border-gray-300");
      });

      // Validate name
      if (!name.value.trim()) {
        isValid = false;
        showError(name, "Prosím zadejte své jméno.");
      }

      // Validate email
      if (!email.value.trim() || !/^\S+@\S+\.\S+$/.test(email.value)) {
        isValid = false;
        showError(email, "Prosím zadejte platný e-mail.");
      }

      if (!isValid) return;

      // Prepare payload
      const payload = {
        accessKey: "sf_m7fcd4fjm9k29127jge1mia0",
        name: name.value.trim(),
        email: email.value.trim(),
        replyTo: email.value.trim(),
        phone: phone.value.trim(),
        message: message.value.trim(),
        $source: "Web fajny3dtisk.cz",
      };

      try {
        const response = await fetch("https://api.staticforms.xyz/submit", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(payload),
        });

        if (response.ok) {
          formMessage.innerHTML = `
            <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg">
              <p class="font-semibold">Děkujeme za zprávu!</p>
              <p class="text-sm">Vaše zpráva byla úspěšně odeslána. Brzy se vám ozvu!</p>
            </div>
          `;
          formMessage.classList.remove("hidden");
          form.reset();
        } else {
          const errorData = await response.json();
          formMessage.innerHTML = `
            <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
              <p class="font-semibold">Chyba při odesílání</p>
              <p class="text-sm">${errorData.error || "Zkuste to prosím znovu později."}</p>
            </div>
          `;
          formMessage.classList.remove("hidden");
        }
      } catch (error) {
        formMessage.innerHTML = `
          <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
            <p class="font-semibold">Chyba při odesílání</p>
            <p class="text-sm">Došlo k chybě. Zkuste to prosím znovu.</p>
          </div>
        `;
        formMessage.classList.remove("hidden");
      }
    });

    function showError(element: HTMLElement, message: string) {
      element.classList.remove("border-gray-300");
      element.classList.add("border-red-500");

      const errorDiv = document.createElement("div");
      errorDiv.className = "error-message text-red-600 text-sm mt-1";
      errorDiv.textContent = message;
      element.parentNode?.appendChild(errorDiv);
    }
  });
</script>
